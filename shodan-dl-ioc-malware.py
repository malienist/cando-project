#!/usr/bin/env python
# Shodan IOC downloader for malware
# Vishal Thakur
# Released under MIT license
import os
import signal
import sys
import time
import subprocess
import shlex


#Define the function that kicks off the download and then converts the json report into csv
def start_downloader(*varargs):
    subprocess.call(shlex.split('shodan download --limit 10000 malware-report category:malware'))
    subprocess.call(shlex.split('shodan convert malware-report.json.gz csv'))
    print('Download complete - report now available as malware.csv')

print("Welcome to Shodan IOC Downloader\nThis script downloads the latest Shodan Malware IOC report with a limit of 10000 (1 credit).")
print("#########################################")
print("You need Shodan CLI Installed and Initialised in order for this script to run successfully."
    "\n"
      "\nIf you do not have it installed, please install it and then run this script again."
      "\nYou can get the Shodan CLI Installer here: https://github.com/vithakur/shodan-tools ")
print("\nYou can proceed to download IOC from Shodan by using your existing Credits - do you have at least 1 Shodan Credit?\ny for yes; n for no")

#Get UserInput to proceed
dl_proceed=raw_input('')
if dl_proceed == 'y':
    print("Cool. Moving to the next step.")
    print("Starting the Shodan CLI now....")
    start_downloader()
else:
    print("Need to register with Shodan and get Credits: http://shodan.io")
    exit()
